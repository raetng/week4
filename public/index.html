<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Reports</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      h1 {
        color: white;
        text-align: center;
        margin-bottom: 30px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }
      .card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      }
      h2 {
        color: #333;
        margin-bottom: 20px;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #444;
      }
      input[type='text'] {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }
      input[type='text']:focus {
        outline: none;
        border-color: #667eea;
      }
      .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 10px;
        margin: 20px 0;
      }
      .checkbox-item {
        display: flex;
        align-items: center;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .checkbox-item:hover {
        background: #e8e8e8;
      }
      .checkbox-item input {
        margin-right: 10px;
        width: 18px;
        height: 18px;
      }
      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 14px 28px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }
      #message {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
      }
      #message.success {
        background: #d4edda;
        color: #155724;
        display: block;
      }
      #message.error {
        background: #f8d7da;
        color: #721c24;
        display: block;
      }
      #reports {
        margin-top: 20px;
      }
      .report-item {
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .report-info {
        flex: 1;
      }
      .report-station {
        font-weight: 700;
        color: #333;
        font-size: 18px;
      }
      .report-conditions {
        color: #666;
        margin-top: 5px;
      }
      .report-date {
        color: #999;
        font-size: 12px;
        margin-top: 5px;
      }
      .delete-btn {
        background: #dc3545;
        padding: 8px 16px;
        font-size: 14px;
      }
      .delete-btn:hover {
        background: #c82333;
        box-shadow: 0 5px 20px rgba(220, 53, 69, 0.4);
      }
      .empty-state {
        text-align: center;
        color: #999;
        padding: 40px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üå§Ô∏è Weather Reports</h1>

      <div class="card">
        <h2>Submit Weather Report</h2>
        <div id="message"></div>
        <form id="weatherForm">
          <div class="form-group">
            <label for="station">Weather Station Code</label>
            <input
              type="text"
              id="station"
              name="station"
              placeholder="e.g., ORD, LAX, JFK"
              required
            />
          </div>

          <label>Weather Conditions</label>
          <div class="checkbox-group">
            <label class="checkbox-item">
              <input type="checkbox" name="fog" id="fog" />
              üå´Ô∏è Fog
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="rain" id="rain" />
              üåßÔ∏è Rain
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="snow" id="snow" />
              ‚ùÑÔ∏è Snow
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="hail" id="hail" />
              üå®Ô∏è Hail
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="thunder" id="thunder" />
              ‚õàÔ∏è Thunder
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="tornado" id="tornado" />
              üå™Ô∏è Tornado
            </label>
          </div>

          <button type="submit">Submit Report</button>
        </form>
      </div>

      <div class="card">
        <h2>Recent Reports</h2>
        <div id="reports">
          <div class="empty-state">Loading reports...</div>
        </div>
      </div>
    </div>

    <script>
      const messageEl = document.getElementById('message');
      const reportsEl = document.getElementById('reports');
      const form = document.getElementById('weatherForm');

      function showMessage(text, type) {
        messageEl.textContent = text;
        messageEl.className = type;
        setTimeout(() => {
          messageEl.className = '';
          messageEl.style.display = 'none';
        }, 3000);
      }

      function getConditions(report) {
        const conditions = [];
        if (report.clear) conditions.push('‚òÄÔ∏è Clear');
        if (report.fog) conditions.push('üå´Ô∏è Fog');
        if (report.rain) conditions.push('üåßÔ∏è Rain');
        if (report.snow) conditions.push('‚ùÑÔ∏è Snow');
        if (report.hail) conditions.push('üå®Ô∏è Hail');
        if (report.thunder) conditions.push('‚õàÔ∏è Thunder');
        if (report.tornado) conditions.push('üå™Ô∏è Tornado');
        return conditions.join(', ') || 'No conditions reported';
      }

      async function loadReports() {
        try {
          const response = await fetch('/weather');
          const reports = await response.json();

          if (reports.length === 0) {
            reportsEl.innerHTML =
              '<div class="empty-state">No reports yet. Submit one above!</div>';
            return;
          }

          reportsEl.innerHTML = reports
            .map(
              (report) => `
          <div class="report-item" data-id="${report.id}">
            <div class="report-info">
              <div class="report-station">${report.station}</div>
              <div class="report-conditions">${getConditions(report)}</div>
              <div class="report-date">${new Date(report.created_at).toLocaleString()}</div>
            </div>
            <button class="delete-btn" onclick="deleteReport(${report.id})">Delete</button>
          </div>
        `
            )
            .join('');
        } catch (error) {
          reportsEl.innerHTML = '<div class="empty-state">Error loading reports</div>';
        }
      }

      async function deleteReport(id) {
        if (!confirm('Are you sure you want to delete this report?')) return;

        try {
          const response = await fetch(`/weather/${id}`, { method: 'DELETE' });
          if (response.ok) {
            showMessage('Report deleted successfully', 'success');
            loadReports();
          } else {
            showMessage('Error deleting report', 'error');
          }
        } catch (error) {
          showMessage('Error deleting report', 'error');
        }
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const data = {
          station: document.getElementById('station').value,
          fog: document.getElementById('fog').checked,
          rain: document.getElementById('rain').checked,
          snow: document.getElementById('snow').checked,
          hail: document.getElementById('hail').checked,
          thunder: document.getElementById('thunder').checked,
          tornado: document.getElementById('tornado').checked
        };

        try {
          const response = await fetch('/weather', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });

          if (response.ok) {
            showMessage('Weather report submitted successfully!', 'success');
            form.reset();
            loadReports();
          } else {
            const error = await response.json();
            showMessage(error.error || 'Error submitting report', 'error');
          }
        } catch (error) {
          showMessage('Error submitting report', 'error');
        }
      });

      // Load reports on page load
      loadReports();
    </script>
  </body>
</html>
